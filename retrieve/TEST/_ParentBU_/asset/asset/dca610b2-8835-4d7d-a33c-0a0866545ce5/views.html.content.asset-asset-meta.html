<script runat='server'>
  Platform.Load('Core','1.1.1');
  try {
</script>
%%[
    SET @emailcheck = QueryParameter("emailcheck")
    SET @CancerCenterSubscribe = QueryParameter("CancerCenterSubscribe")
    /*
    SET @CancerCompassNewsletter = QueryParameter("CancerCompassNewsletter")
    */
    SET @CancerFighters = QueryParameter("CancerFighters")
    SET @PersonalizedEduEmails = QueryParameter("PersonalizedEduEmails")
    /*
    SET @hereAndNow = QueryParameter("hereAndNow")
    */
    SET @riskManagement = QueryParameter("riskManagement")
    /* Hiding FoC March 2022
    SET @focusOnCancer = QueryParameter("focusOnCancer")
    */
    /*Huron Note: Adding Celebrate Life query parameter March 2022*/
    SET @celebrateLife = QueryParameter("celebrateLife")
    SET @OJOH = QueryParameter("OJOH")
    /* SET @EmployerRelations = QueryParameter("EmployerRelations")
    SET @PhysicianRelations = QueryParameter("PhysicianRelations") Removed by Huron September 2023*/
    SET @CityStories = QueryParameter("CityStories")
    SET @PatientAlerts = QueryParameter("PatientAlerts")
    SET @PatientNewsletter = QueryParameter("PatientNewsletter")
    SET @PatientOfferings = QueryParameter("PatientOfferings")
    /*Unsubscribed Status updation for All Subscribers */
    SET @lookall = LookupRows("ENT._Subscribers", "EmailAddress", @emailcheck)
    SET @lookcount = rowcount(@lookall)
    IF @lookcount > 0 THEN
        FOR @I = 1 TO ROWCOUNT(@LOOKALL) DO
            SET @row = Row(@lookall, @i)
            SET @Subkey = Field(@row, "SubscriberKey")
            SET @ll_sub = CreateObject("Subscriber")
            SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
            SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
            SetObjectProperty(@ll_sub, "Status", "Unsubscribed")
            SET @Result = InvokeUpdate(@ll_sub, @status_msg, @Update_err)
        NEXT @i
    ENDIF
    SET @pslead = RetrieveSalesforceObjects(
        'Lead',
        'Caregiver_Email__c',
        'Caregiver_Email__c',
        '=',
        @emailcheck
    )
    SET @careLead = rowcount(@pslead)
    IF @careLead > 0 THEN
        SET @psLeadrecord = 1
    ELSE
        SET @psLeadrecord = 0
    ENDIF
    SET @slead = RetrieveSalesforceObjects(
        'Lead',
        'Email',
        'Email',
        '=',
        @emailcheck
    )
    SET @countLead = rowcount(@slead)
    IF @countLead > 0 THEN
        SET @sleadrecord = 1
    ELSE
        SET @sleadrecord = 0
    ENDIF
    SET @sContact = RetrieveSalesforceObjects(
        'Contact',
        'Email',
        'Email',
        '=',
        @emailcheck
    )
    SET @countContact = rowcount(@sContact)
    IF @countContact > 0 THEN
        SET @scontactrecord = 1
    ELSE
        SET @scontactrecord = 0
    ENDIF
    SET @rsOpp = RetrieveSalesforceObjects(
        'Opportunity',
        'Email__c',
        'Email__c',
        '=',
        @emailcheck
    )
    SET @countOpp = rowcount(@rsOpp)
    IF @countOpp > 0 THEN
        SET @opprecord = 1
    ELSE
        SET @opprecord = 0
    ENDIF
    IF @psLeadrecord == 1 OR @sleadrecord == 1 OR @scontactrecord == 1 OR @opprecord == 1 THEN
        SET @notExistSalesforce = "False"
    ELSEIF @psLeadrecord == 0 OR @sleadrecord == 0 OR @scontactrecord == 0 OR @opprecord == 0 THEN
        SET @notExistSalesforce = "true"
    ENDIF
    IF @CancerCenterSubscribe == "Unsubscribed" THEN
        SET @upsCancerCenter = UpsertData(
            'ENT.CancerCenter_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @CancerCenterSubscribe,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookCancerCenter = Lookup('ENT.CancerCenter_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookCancerCenter) THEN
            SET @upCancerCenter = UpdateData(
                'ENT.CancerCenter_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @CancerCenterSubscribe,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    /*
    IF @CancerCompassNewsletter == "Unsubscribed" then
        SET @upsCancerCom = UpsertData(
            'ENT.CancerCompass_DE',
            1,
            'EmailAddr',
            @emailcheck,
            'Status',
            @CancerCompassNewsletter,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookCancerCom = Lookup('ENT.CancerCompass_DE', 'Status', 'EmailAddr', @emailcheck)
        If not empty(@lookCancerCom) then
            SET @upCancerCom = UpdateData(
                'ENT.CancerCompass_DE',
                1,
                'EmailAddr',
                @emailcheck,
                'Status',
                @CancerCompassNewsletter,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    */
    IF @CancerFighters == "Unsubscribed" THEN
        SET @upsCancerFighter = UpsertData(
            'ENT.CancerFighter_Preference_center',
            1,
            'Email',
            @emailcheck,
            'Status',
            @CancerFighters,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookCancerFighter = Lookup('ENT.CancerFighter_Preference_center', 'Status', 'Email', @emailcheck)
        IF not empty(@lookCancerFighter) THEN
            SET @upCancerFighter = UpdateData(
                'ENT.CancerFighter_Preference_center',
                1,
                'Email',
                @emailcheck,
                'Status',
                @CancerFighters,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    IF @PersonalizedEduEmails == "Unsubscribed" THEN
        SET @upsPersonalizedEmail = UpsertData(
            'ENT.Personalized_Email_Preference_center',
            1,
            'Email',
            @emailcheck,
            'Status',
            @PersonalizedEduEmails,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookPersonalizedEmail = Lookup('ENT.Personalized_Email_Preference_center', 'Status', 'Email', @emailcheck)
        IF not empty(@lookPersonalizedEmail) THEN
            SET @upPersonalizedEmails = UpdateData(
                'ENT.Personalized_Email_Preference_center',
                1,
                'Email',
                @emailcheck,
                'Status',
                @PersonalizedEduEmails,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    /*
    if @hereAndNow == "Unsubscribed" then
        SET @insHn = UpsertData(
            'ENT.Atlanta_Here_and_Now_NL_Subscriber_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @hereAndNow,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookhn = Lookup('ENT.Atlanta_Here_and_Now_NL_Subscriber_DE', 'Status', 'Email', @emailcheck)
        if not empty(@lookhn) then
            SET @UpHn = UpdateData(
                'ENT.Atlanta_Here_and_Now_NL_Subscriber_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @hereAndNow,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    */
    IF @riskManagement == "Unsubscribed" THEN
        SET @ins = UpsertData(
            'ENT.RMTPreferenceCenterSubscribers',
            1,
            'Email',
            @emailcheck,
            'Status',
            @riskManagement,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookrm = Lookup('ENT.RMTPreferenceCenterSubscribers', 'Status', 'Email', @emailcheck)
        IF not empty(@lookrm) THEN
            SET @UpRm = UpdateData(
                'ENT.RMTPreferenceCenterSubscribers',
                1,
                'Email',
                @emailcheck,
                'Status',
                @riskManagement,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    /* Hide FoC March 2022
    if @focusOnCancer == "Unsubscribed" then
        SET @insFocusOnCancer = UpsertData(
            'ENT.FocusOnCancer_Preference_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @focusOnCancer,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookFoC = Lookup('ENT.FocusOnCancer_Preference_DE', 'Status', 'Email', @emailcheck)
        if not empty(@lookFoC) then
            SET @UpFocusOnCancer = UpdateData(
                'ENT.FocusOnCancer_Preference_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @focusOnCancer,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    */
    /*Huron: Add or Update record in Celebrate Life Prefrence DE */
    IF @celebrateLife == "Unsubscribed" THEN
        SET @insCL = UpsertData(
            'ENT.CelebrateLife_Preference_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @celebrateLife,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookCL = Lookup('ENT.CelebrateLife_Preference_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookCL) THEN
            SET @UpCL = UpdateData(
                'ENT.CelebrateLife_Preference_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @celebrateLife,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    IF @OJOH == "Unsubscribed" THEN
        SET @insOJOH = UpsertData(
            'ENT.OJOH_Preference_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @OJOH,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookOJOH = Lookup('ENT.OJOH_Preference_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookOJOH) THEN
            SET @UpOJOH = UpdateData(
                'ENT.OJOH_Preference_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @OJOH,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    /*Removed by Huron September 2023: Add or Update record in Employer Relations Prefrence DE
    if @EmployerRelations == "Unsubscribed" then
        SET @insEmpRel = UpsertData(
            'ENT.EmployerRelations_Preference_Center',
            1,
            'Email',
            @emailcheck,
            'Status',
            @EmployerRelations,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookEmpRel = Lookup('ENT.EmployerRelations_Preference_Center', 'Status', 'Email', @emailcheck)
        if not empty(@lookEmpRel) then
            SET @UpEmpRel = UpdateData(
                'ENT.EmployerRelations_Preference_Center',
                1,
                'Email',
                @emailcheck,
                'Status',
                @EmployerRelations,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    */
    /*Removed by Huron September 2023: Add or Update record in Physician Relations Prefrence DE
    IF @PhysicianRelations == "Unsubscribed" THEN
        SET @insPhysRel = UpsertData(
            'ENT.PhysicianRelations_Preference_Center',
            1,
            'Email',
            @emailcheck,
            'Status',
            @PhysicianRelations,
            'Permission Source',
            'Preference Center',
            'Email Permission Date',
            now()
        )
    ELSE
        SET @lookPhysRel = Lookup('ENT.PhysicianRelations_Preference_Center', 'Status', 'Email', @emailcheck)
        IF not empty(@lookPhysRel) THEN
            SET @UpPhysRel = UpdateData(
                'ENT.PhysicianRelations_Preference_Center',
                1,
                'Email',
                @emailcheck,
                'Status',
                @PhysicianRelations,
                'Permission Source',
                'Preference Center',
                'Email Permission Date',
                now()
            )
        ENDIF
    ENDIF
    */
    IF @CityStories == "Unsubscribed" THEN
        SET @upsCityStories = UpsertData(
            'ENT.CityStories_Preference_Center_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @CityStories,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookCityStories = Lookup('ENT.CityStories_Preference_Center_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookCityStories) THEN
            SET @upCityStories = UpdateData(
                'ENT.CityStories_Preference_Center_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @CityStories,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    IF @PatientAlerts == "Unsubscribed" THEN
        SET @upsPatientAlerts = UpsertData(
            'ENT.Patient_Alerts_Preference_Center_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @PatientAlerts,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookPatientAlerts = Lookup('ENT.Patient_Alerts_Preference_Center_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookPatientAlerts) THEN
            SET @upPatientAlerts = UpdateData(
                'ENT.Patient_Alerts_Preference_Center_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @PatientAlerts,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    IF @PatientNewsletter == "Unsubscribed" THEN
        SET @upsPatientNewsletter = UpsertData(
            'ENT.Patient_Newsletter_Preference_Center_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @PatientNewsletter,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookPatientNewsletter = Lookup('ENT.Patient_Newsletter_Preference_Center_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookPatientNewsletter) THEN
            SET @upPatientNewsletter = UpdateData(
                'ENT.Patient_Newsletter_Preference_Center_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @PatientNewsletter,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    IF @PatientOfferings == "Unsubscribed" THEN
        SET @upsPatientOfferings = UpsertData(
            'ENT.Patient_Offerings_Preference_Center_DE',
            1,
            'Email',
            @emailcheck,
            'Status',
            @PatientOfferings,
            'Permission Source',
            'Preference Center',
            'LastModifiedDate',
            now(),
            'NotExistsSalesforce',
            @notExistSalesforce
        )
    ELSE
        SET @lookPatientOfferings = Lookup('ENT.Patient_Offerings_Preference_Center_DE', 'Status', 'Email', @emailcheck)
        IF not empty(@lookPatientOfferings) THEN
            SET @upPatientOfferings = UpdateData(
                'ENT.Patient_Offerings_Preference_Center_DE',
                1,
                'Email',
                @emailcheck,
                'Status',
                @PatientOfferings,
                'Permission Source',
                'Preference Center',
                'LastModifiedDate',
                now(),
                'NotExistsSalesforce',
                @notExistSalesforce
            )
        ENDIF
    ENDIF
    /*Start - Update Cancer Center Publication List*/
    IF not empty(@CancerCenterSubscribe) THEN
        SET @LookCancerCenter = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '3161'
        )
        IF @CancerCenterSubscribe == "Unsubscribed" THEN
            IF rowcount(@LookCancerCenter) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@LOOKCANCERCENTER) DO
                    SET @row = Row(@LookCancerCenter, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "3161")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@LookCancerCenter) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@LOOKCANCERCENTER) DO
                    SET @row = Row(@LookCancerCenter, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "3161")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End- upadte Cancer center Publication list*/
    /*Start - Update Cancer Compass Publication List*/
    /*
    if not empty(@CancerCompassNewsletter) then
        SET @LookCancerCompass = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '3160'
        )
        IF @CancerCompassNewsletter == "Unsubscribed" THEN
            SET @block = "this is unsubscribe"
            if rowcount(@LookCancerCompass) !=0 then
                FOR @I = 1 TO ROWCOUNT(@LOOKCANCERCOMPASS) DO
                    SET @row = Row(@LookCancerCompass, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","3160")
                    SetObjectProperty( @subscription, "Status", "Unsubscribed" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            if rowcount(@LookCancerCompass) !=0 then
                FOR @J = 1 TO ROWCOUNT(@LOOKCANCERCOMPASS) DO
                    SET @row = Row(@LookCancerCompass, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @block = "this is active"
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","3160")
                    SetObjectProperty( @subscription, "Status", "Active" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    */
    /*End - Update Cancer Compass Publication List*/
    /* Start - Update Cancer Fighter publication list*/
    IF not empty(@CancerFighters) THEN
        SET @LookCancerFighter = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '4090'
        )
        IF @CancerFighters == "Unsubscribed" THEN
            IF rowcount(@LookCancerFighter) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@LOOKCANCERFIGHTER) DO
                    SET @row = Row(@LookCancerFighter, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "4090")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@LookCancerFighter) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@LOOKCANCERFIGHTER) DO
                    SET @row = Row(@LookCancerFighter, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "4090")
                    SetObjectProperty(@subscription, "Status", "Active")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update Cancer Fighter Publication list*/
    /* Start- update Personalised educational email */
    SET @LookPersonalizedEmail = lookuprows(
        "ENT._ListSubscribers",
        "EmailAddress",
        @emailcheck,
        "ListID",
        "4091"
    )
    IF @PersonalizedEduEmails == "Unsubscribed" THEN
        IF rowcount(@LookPersonalizedEmail) !=0 THEN
            FOR @I = 1 TO ROWCOUNT(@LOOKPERSONALIZEDEMAIL) DO
                SET @row = Row(@LookPersonalizedEmail, @i)
                SET @Subkey = Field(@row, "SubscriberKey")
                SET @ll_sub = CreateObject("Subscriber")
                SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "4091")
                SetObjectProperty(@subscription, "Status", "Unsubscribed")
                AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
            NEXT @i
        ENDIF
    ELSE
        IF rowcount(@LookPersonalizedEmail) !=0 THEN
            FOR @J = 1 TO ROWCOUNT(@LOOKPERSONALIZEDEMAIL) DO
                SET @row = Row(@LookPersonalizedEmail, @j)
                SET @Subkey = Field(@row, "SubscriberKey")
                SET @ll_sub = CreateObject("Subscriber")  //updating All Subscriber     SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "4091")
                SetObjectProperty(@subscription, "Status", "Active")
                AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
            NEXT @j
        ENDIF
    ENDIF
    /* End- Personalised educational email */
    /* BEGIN Here and Now Publication List Update */
    /*
    if not empty(@hereAndNow) then
        SET @HereNowRows = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '14602'
        )
        IF @hereAndNow == "Unsubscribed" THEN
            if rowcount(@HereNowRows) !=0 then
                FOR @I = 1 TO ROWCOUNT(@HERENOWROWS) DO
                    SET @row = Row(@HereNowRows, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","14602")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Unsubscribed" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            if rowcount(@HereNowRows) !=0 then
                FOR @J = 1 TO ROWCOUNT(@HERENOWROWS) DO
                    SET @row = Row(@HereNowRows, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","14602")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Active" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    */
    /* END Here and Now Publication List Update */
    /*risk Management publication list and object updation*/
    IF not empty(@riskManagement) THEN
        SET @rManagement = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '14601'
        )
        IF @riskManagement == "Unsubscribed" THEN
            IF rowcount(@rManagement) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@RMANAGEMENT) DO
                    SET @row = Row(@rManagement, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "14601")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@rManagement) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@RMANAGEMENT) DO
                    SET @row = Row(@rManagement, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "14601")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*Cancerfighter contact updation for Active and Unsubscribe*/
    IF @CancerFighters == "Active" THEN
        SET @rsContact = RetrieveSalesforceObjects(
            'Contact',
            'Id',
            'Email',
            '=',
            @emailcheck
        )
        SET @countContact = rowcount(@rsContact)
        IF @countContact > 0 THEN
            FOR @J = 1 TO @COUNTCONTACT DO
                SET @ContactRow = Row(@rsContact, @j)
                SET @ContactID = Field(@ContactRow, "ID")
                IF NOT EMPTY(@ContactID) THEN
                    SET @result = UpdateSingleSalesforceObject('Contact', @ContactID, 'Receive_valuable_info_from_CF__c', 'True')
                ENDIF
            NEXT @j
        ENDIF
    ENDIF
    IF @CancerFighters == "Unsubscribed" THEN
        SET @rsContact = RetrieveSalesforceObjects(
            'Contact',
            'Id',
            'Email',
            '=',
            @emailcheck
        )
        SET @countContact = rowcount(@rsContact)
        IF @countContact > 0 THEN
            FOR @J = 1 TO @COUNTCONTACT DO
                SET @ContactRow = Row(@rsContact, @j)
                SET @ContactID = Field(@ContactRow, "ID")
                IF NOT EMPTY(@ContactID) THEN
                    SET @result = UpdateSingleSalesforceObject('Contact', @ContactID, 'Receive_valuable_info_from_CF__c', 'False')
                ENDIF
            NEXT @j
        ENDIF
    ENDIF
    /*CancerFighter record verification*/
    SET @rsContact = RetrieveSalesforceObjects(
        'Contact',
        'Ctca_iscancerfighter__c, Id',
        'Email',
        '=',
        @emailcheck
    )
    SET @contactcounter = 0
    IF rowcount(@rsContact) > 0 THEN
        FOR @I = 1 TO ROWCOUNT(@RSCONTACT) DO
            SET @contRow = Row(@rsContact, @i)
            SET @stat = Field(@contRow, "Ctca_iscancerfighter__c")
            IF @stat == "CF" OR @stat == "CFCN" THEN
                IF @CancerFighters == "Unsubscribed" THEN
                    SET @CurrentContactId = Field(@contRow, "Id")
                    /*Hide code to update CF Status to No - Huron March 2022*/
                    /*UpdateSingleSalesforceObject('Contact',@CurrentContactId,'Ctca_iscancerfighter__c','No')*/
                ENDIF
                SET @contactcounter = add(@contactcounter, 1)
            ENDIF
        NEXT @i
        IF @contactcounter == 0 THEN
            SET @upCancerFighter = UpdateData(
                'ENT.CancerFighter_Preference_center',
                1,
                'Email',
                @emailcheck,
                'NotCancerFighter',
                'True'
            )
        ELSE
            SET @upCancerFighter = UpdateData(
                'ENT.CancerFighter_Preference_center',
                1,
                'Email',
                @emailcheck,
                'NotCancerFighter',
                'False'
            )
        ENDIF
    ELSE
        SET @upsCancerFighters = UpdateData(
            'ENT.CancerFighter_Preference_center',
            1,
            'Email',
            @emailcheck,
            'NotCancerFighter',
            'True'
        )
    ENDIF
    /*updating Unsubscribe and Active status to Personalised Email Lead and contact records*/
    IF @PersonalizedEduEmails == "Unsubscribed" THEN
        SET @rsLead = RetrieveSalesforceObjects(
            'Lead',
            'Id, IsConverted',
            'Email',
            '=',
            @emailcheck
        )
        SET @countLead = rowcount(@rsLead)
        IF @countLead > 0 THEN
            FOR @I = 1 TO @COUNTLEAD DO
                SET @LeadRow = Row(@rsLead, @i)
                SET @LeadID = Field(@LeadRow, "Id")
                SET @leadconverted = Field(@LeadRow, "IsConverted")
                IF NOT EMPTY(@LeadID) AND @leadconverted != 'True' THEN
                    SET @result = UpdateSingleSalesforceObject('Lead', @LeadID, 'Nurture_Preference__c', 'Declined')
                ENDIF
            NEXT @i
        ENDIF
    ENDIF
    IF @PersonalizedEduEmails == "Active" THEN
        SET @personalisedLead = RetrieveSalesforceObjects(
            'Lead',
            'Id, IsConverted',
            'Email',
            '=',
            @emailcheck
        )
        SET @countlead1 = rowcount(@personalisedLead)
        IF @countlead1 > 0 THEN
            FOR @I = 1 TO @COUNTLEAD1 DO
                SET @ldrow = Row(@personalisedLead, @i)
                SET @ldID = Field(@ldrow, "Id")
                SET @leadconverted1 = Field(@ldrow, "IsConverted")
                IF NOT EMPTY(@ldID) AND @leadconverted1 != 'True' THEN
                    SET @result = UpdateSingleSalesforceObject('Lead', @ldID, 'Nurture_Preference__c', 'Subscribe')
                ENDIF
            NEXT @i
        ENDIF
    ENDIF
    /*updating Unsubscribe and Active status to Personalised Opportunity*/
    IF @PersonalizedEduEmails == "Unsubscribed" THEN
        SET @rsOpp = RetrieveSalesforceObjects(
            'Opportunity',
            'Id',
            'Email__c',
            '=',
            @emailcheck
        )
        SET @Countopp = rowcount(@rsopp)
        IF @countOpp > 0 THEN
            FOR @K = 1 TO @COUNTOPP DO
                SET @OppRow = Row(@rsOpp, @k)
                SET @OppID = Field(@OppRow, "ID")
                IF NOT EMPTY(@OppID) THEN
                    SET @result = UpdateSingleSalesforceObject('Opportunity', @OppID, 'Nurture_Preference__c', 'Declined')
                ENDIF
            NEXT @k
        ENDIF
    ENDIF
    IF @PersonalizedEduEmails == "Active" THEN
        SET @rsOpp = RetrieveSalesforceObjects(
            'Opportunity',
            'Id',
            'Email__c',
            '=',
            @emailcheck
        )
        SET @Countopp = rowcount(@rsopp)
        IF @countOpp > 0 THEN
            FOR @K = 1 TO @COUNTOPP DO
                SET @OppRow = Row(@rsOpp, @k)
                SET @OppID = Field(@OppRow, "ID")
                IF NOT EMPTY(@OppID) THEN
                    SET @result = UpdateSingleSalesforceObject('Opportunity', @OppID, 'Nurture_Preference__c', 'Subscribe')
                ENDIF
            NEXT @k
        ENDIF
    ENDIF
    /*updating DateSent in PersonalizedEduEmails*/
    SET @look = lookuprows('ENT.JourneyTracking_DE', 'EmailId', @emailcheck)
    IF rowcount(@look) == 0 THEN
        SET @upde = updatedata(
            'ENT.Personalized_Email_Preference_center',
            1,
            'Email',
            @emailcheck,
            'No_Nurture_Record_found',
            'True'
        )
    ELSE
        SET @lkrow = lookuporderedrows(
            'ENT.JourneyTracking_DE',
            0,
            'DateSent desc',
            'EmailId',
            @emailcheck
        )
        SET @countrows = rowcount(@lkrow)
        IF @countrows > 0 THEN
            SET @PBRow = Row(@lkrow, 1)
            SET @Date = Field(@PBRow, "DateSent")
            SET @email = Field(@PBRow, "EmailId")
            SET @upde = updatedata(
                'ENT.Personalized_Email_Preference_center',
                1,
                'Email',
                @emailcheck,
                'Last_Nurture_Date',
                @Date
            )
        ENDIF
        SET @upde2 = updatedata(
            'ENT.Personalized_Email_Preference_center',
            1,
            'Email',
            @emailcheck,
            'No_Nurture_Record_found',
            'False'
        )
    ENDIF
    /*Updating NoRmtRecordFound in DE */
    SET @rsLead = RetrieveSalesforceObjects(
        'Lead',
        'RecordTypeId',
        'Email',
        '=',
        @emailcheck
    )
    SET @RmtLeadCounter = 0
    IF rowcount(@rsLead) != 0 THEN
        FOR @I = 1 TO ROWCOUNT(@RSLEAD) DO
            SET @rsrowlead = Row(@rsLead, @i)
            SET @riskasmt = Field(@rsrowlead, "RecordTypeId")
            IF @riskasmt == "0121C000001pMVWQA2" THEN
                SET @RmtLeadCounter = add(@RmtLeadCounter, 1)
            ENDIF
        NEXT @i
    ENDIF
    SET @rsContact = RetrieveSalesforceObjects(
        'Contact',
        'Id, Risk_Assessment_LeadId__c',
        'Email',
        '=',
        @emailcheck
    )
    SET @rmtcontactcounter = 0
    IF rowcount(@rsContact) > 0 THEN
        FOR @J = 1 TO ROWCOUNT(@RSCONTACT) DO
            SET @rsrowcontact = Row(@rsContact, @j)
            SET @riskassessment = Field(@rsrowcontact, "Risk_Assessment_LeadId__c")
            IF not empty(@riskassessment) THEN
                SET @rmtcontactcounter = add(@rmtcontactcounter, 1)
            ENDIF
        NEXT @j
    ENDIF
    IF @RmtLeadCounter > 0 OR @rmtcontactcounter > 0 THEN
        SET @LookRiskmanagement = LookupRows('ENT.RMTPreferenceCenterSubscribers', 'Email', @emailcheck)
        IF rowcount(@LookRiskmanagement) > 0 THEN
            SET @updaterecord = updateData(
                'ENT.RMTPreferenceCenterSubscribers',
                1,
                'Email',
                @emailcheck,
                'NoRMTRecordFound',
                'False'
            )
        ENDIF
    ELSE
        SET @LookRiskmanagementcount = LookupRows('ENT.RMTPreferenceCenterSubscribers', 'Email', @emailcheck)
        IF rowcount(@LookRiskmanagementcount) > 0 THEN
            SET @updaterecord2 = updateData(
                'ENT.RMTPreferenceCenterSubscribers',
                1,
                'Email',
                @emailcheck,
                'NoRMTRecordFound',
                'True'
            )
        ENDIF
    ENDIF
    /*Risk Management object status updation*/
    IF @riskManagement == "Unsubscribed" THEN
        SET @ObRisklead = RetrieveSalesforceObjects(
            "Lead",
            "Id,IsConverted",
            "Email",
            "=",
            @emailcheck
        )
        IF rowcount(@ObRisklead) > 0 THEN
            FOR @I = 1 TO ROWCOUNT(@OBRISKLEAD) DO
                SET @objrowslead = Row(@ObRisklead, @i)
                SET @skey = Field(@objrowslead, "Id")
                SET @ldconverted = Field(@objrowslead, "IsConverted")
                IF @ldconverted != 'True' THEN
                    SET @ObUpdate = UpdateSingleSalesforceObject(
                        'Lead',
                        @skey,
                        'RMT_Opt_In_Status__c',
                        "Unsubscribed",
                        'RMT_Unsubscribed_Date__c',
                        FormatDate(Now(), "iso")
                    )
                ENDIF
            NEXT @i
        ENDIF
    ENDIF
    IF @riskManagement == "Unsubscribed" THEN
        SET @ObRiskcontact = RetrieveSalesforceObjects(
            "Contact",
            "Id",
            "Email",
            "=",
            @emailcheck
        )
        IF rowcount(@ObRiskcontact) > 0 THEN
            FOR @J = 1 TO ROWCOUNT(@OBRISKCONTACT) DO
                SET @objrowscontct = Row(@ObRiskcontact, @j)
                SET @skey = Field(@objrowscontct, "Id")
                SET @ConUpdate = UpdateSingleSalesforceObject(
                    'Contact',
                    @skey,
                    'RMT_Opt_In_Status__c',
                    "Unsubscribed",
                    'RMT_Unsubscribed_Date__c',
                    FormatDate(Now(), "iso")
                )
            NEXT @j
        ENDIF
    ENDIF
    /*Hide FoC March 2022*/
    /*Start - Update Focus on Cancer Publication List*/
    /* if not empty(@focusOnCancer) then
        SET @LookFocusOnCancer = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '15583'
        )
        IF @focusOnCancer == "Unsubscribed" THEN
            if rowcount(@LookFocusOnCancer) !=0 then
                FOR @I = 1 TO ROWCOUNT(@LOOKFOCUSONCANCER) DO
                    SET @row = Row(@LookFocusOnCancer, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","15583")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Unsubscribed" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            if rowcount(@LookFocusOnCancer) !=0 then
                FOR @J = 1 TO ROWCOUNT(@LOOKFOCUSONCANCER) DO
                    SET @row = Row(@LookFocusOnCancer, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","15583")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Active" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    */
    /*End - Update Focus on Cancer Publication List*/
    /*Start - Update OJOH Publication List*/
    IF not empty(@OJOH) THEN
        SET @LookOJOH = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '15582'
        )
        IF @OJOH == "Unsubscribed" THEN
            IF rowcount(@LookOJOH) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@LOOKOJOH) DO
                    SET @row = Row(@LookOJOH, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email   SetObjectProperty(@subscription, "ID", "15582")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@LookOJOH) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@LOOKOJOH) DO
                    SET @row = Row(@LookOJOH, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "15582")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update OJOH Publication List*/
    /*Huron Note: Celebrate Life Publication List updates March 2022*/
    /* Start : Update  Celebrate Life Publication List */
    IF not empty(@celebrateLife) THEN
        SET @LookCL = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '17060'
        )
        IF @celebrateLife == "Unsubscribed" THEN
            IF rowcount(@LookCL) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@LOOKCL) DO
                    SET @row = Row(@LookCL, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email   SetObjectProperty(@subscription, "ID", "17060")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@LookCL) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@LOOKCL) DO
                    SET @row = Row(@LookCL, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "17060")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update Celebrate Life Publication List*/
    /*Huron Note: Removed September 2023; Update Employer Relations Publication List July 2021
    Start : Update Employer Relations Publication List
    IF not empty(@EmployerRelations) THEN
        SET @EmpRelRows = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '16461'
        )
        IF @EmployerRelations == "Unsubscribed" THEN
            IF rowcount(@EmpRelRows) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@EMPRELROWS) DO
                    SET @row = Row(@EmpRelRows, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty(@subscription, "ID", "16461")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@EmpRelRows) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@EMPRELROWS) DO
                    SET @row = Row(@EmpRelRows, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty(@subscription, "ID", "16461")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    */
    /*End - Update Employer Relations Publication List*/
    /* Removed by Huron September 2023; START : Update Employer Communication Preferences field on Contact to Declined or Subscribed for Employer Partners
    IF @EmployerRelations == "Unsubscribed"  THEN
        SET @rsContact = RetrieveSalesforceObjects(
            'Contact',
            'Id',
            'Email',
            '=',
            @emailcheck
        )
        SET @countContact = rowcount(@rsContact)
        IF @countContact > 0 THEN
            FOR @J = 1 TO @COUNTCONTACT DO
                
                SET @ContactRow = Row(@rsContact, @j)
                SET @ContactID = Field(@ContactRow, "ID")
                
                IF NOT EMPTY(@ContactID) THEN
                    SET @result = UpdateSingleSalesforceObject('Contact', @ContactID, 'Employer_Communication_Preferences__c', 'Declined')
                ENDIF
            NEXT @j
        ENDIF
        
    ELSE
        SET @rsContact = RetrieveSalesforceObjects(
            'Contact',
            'Id',
            'Email',
            '=',
            @emailcheck
        )
        SET @countContact = rowcount(@rsContact)
        IF @countContact > 0 THEN
            FOR @J = 1 TO @COUNTCONTACT DO
                
                SET @ContactRow = Row(@rsContact, @j)
                SET @ContactID = Field(@ContactRow, "ID")
                
                IF NOT EMPTY(@ContactID) THEN
                    SET @result = UpdateSingleSalesforceObject('Contact', @ContactID, 'Employer_Communication_Preferences__c', 'Subscribe')
                    
                    /*Huron July 2021: The following update is under discussion and would require update to Contact.HasOptedOutOfEmail Validation Rule*/
                    /*
                    SET @result2 = UpdateSingleSalesforceObject('Contact', @ContactID, 'HasOptedOutOfEmail', 0)*/
                    /*SET @hasOptedOutCheckbox = RetrieveSalesforceObjects(
                        'Contact',
                        'HasOptedOutOfEmail',
                        'Email',
                        '=',
                        @emailcheck
                    )
                    
                ENDIF
            NEXT @j
        ENDIF
        
    ENDIF
    */
    /* END : Update Employer Communication Preferences field on Contact to Declined for Employer Partners */
    /*Huron Note: Removed September 2023; Created Physician Relations Publication List December 2022
    if not empty(@PhysicianRelations) then
        SET @PhysRelRows = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '8724'
        )
        IF @PhysicianRelations == "Unsubscribed" THEN
            if rowcount(@PhysRelRows) !=0 then
                FOR @I = 1 TO ROWCOUNT(@PHYSRELROWS) DO
                    SET @row = Row(@PhysRelRows, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","8724")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Unsubscribed" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            if rowcount(@PhysRelRows) !=0 then
                FOR @J = 1 TO ROWCOUNT(@PHYSRELROWS) DO
                    SET @row = Row(@PhysRelRows, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty( @subscription, "ID","8724")
                    SetObjectProperty( @subscription, "IDSpecified", "true" )
                    SetObjectProperty( @subscription, "Status", "Active" )
                    SetObjectProperty( @subscription, "StatusSpecified", "true" )
                    AddObjectArrayItem( @ll_sub, "Lists", @subscription )
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    */
    /*End - Update Physician Relations Publication List*/
    /*City Stories publication list and object updation - added by Huron October 2023*/
    IF not empty(@CityStories) THEN
        SET @cStories = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '18015'
        )
        IF @CityStories == "Unsubscribed" THEN
            IF rowcount(@cStories) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@CSTORIES) DO
                    SET @row = Row(@cStories, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "18015")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@cStories) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@CSTORIES) DO
                    SET @row = Row(@cStories, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "18015")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update City Stories Publication List*/
    /*Patient Alerts publication list and object updation - added by Huron October 2023*/
    IF not empty(@PatientAlerts) THEN
        SET @pAlerts = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '18013'
        )
        IF @PatientAlerts == "Unsubscribed" THEN
            IF rowcount(@pAlerts) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@PALERTS) DO
                    SET @row = Row(@pAlerts, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "18013")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@pAlerts) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@PALERTS) DO
                    SET @row = Row(@pAlerts, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "18013")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update Patient Alerts Publication List*/
    /*Patient Newsletter publication list and object updation - added by Huron October 2023*/
    IF not empty(@PatientNewsletter) THEN
        SET @pNewsletter = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '18012'
        )
        IF @PatientNewsletter == "Unsubscribed" THEN
            IF rowcount(@pNewsletter) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@PNEWSLETTER) DO
                    SET @row = Row(@pNewsletter, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "18012")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@pNewsletter) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@PNEWSLETTER) DO
                    SET @row = Row(@pNewsletter, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "18013")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update Patient Newsletter Publication List*/
    /*Patient Offerings publication list and object updation - added by Huron October 2023*/
    IF not empty(@PatientOfferings) THEN
        SET @pOfferings = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '18014'
        )
        IF @PatientOfferings == "Unsubscribed" THEN
            IF rowcount(@pOfferings) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@POFFERINGS) DO
                    SET @row = Row(@pOfferings, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email     SetObjectProperty(@subscription, "ID", "18014")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@pOfferings) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@POFFERINGS) DO
                    SET @row = Row(@pOfferings, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email    SetObjectProperty(@subscription, "ID", "18013")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    /*End - Update Patient Offerings Publication List*/
    /*Huron Note: Replaced October 2023; Created Patient Newsletter Publication List September 2023
    IF not empty(@PatientNewsletter) THEN
        SET @PatientNewsletterRows = lookuprows(
            "ENT._ListSubscribers",
            "EmailAddress",
            @emailcheck,
            'ListId',
            '18012'
        )
        IF @PatientNewsletter == "Unsubscribed" THEN
            IF rowcount(@PatientNewsletterRows) !=0 THEN
                FOR @I = 1 TO ROWCOUNT(@PATIENTNEWSLETTERROWS) DO
                    SET @row = Row(@PatientNewsletterRows, @i)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty(@subscription, "ID", "18012")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Unsubscribed")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @i
            ENDIF
        ELSE
            IF rowcount(@PatientNewsletterRows) !=0 THEN
                FOR @J = 1 TO ROWCOUNT(@PATIENTNEWSLETTERROWS) DO
                    SET @row = Row(@PatientNewsletterRows, @j)
                    SET @Subkey = Field(@row, "SubscriberKey")
                    SET @ll_sub = CreateObject("Subscriber")
                    SetObjectProperty(@ll_sub, "EmailAddress", @emailcheck)
                    SetObjectProperty(@ll_sub, "SubscriberKey", @Subkey)
                    SET @subscription = CreateObject("SubscriberList") //process_listid from your original email
                    SetObjectProperty(@subscription, "ID", "18012")
                    SetObjectProperty(@subscription, "IDSpecified", "true")
                    SetObjectProperty(@subscription, "Status", "Active")
                    SetObjectProperty(@subscription, "StatusSpecified", "true")
                    AddObjectArrayItem(@ll_sub, "Lists", @subscription)
                    SET @ll_statusCode = InvokeUpdate(@ll_sub, @ll_statusMsg, @errorCode)
                NEXT @j
            ENDIF
        ENDIF
    ENDIF
    End - Update Patient Newsletter Publication List*/
]%%
<script runat='server'>
  } 
  catch(e) {
    Write(Stringify(e));
  }
</script>  

Status: %%=v(@status_msg)=%%<br>
errorinallsub: %%=v(@Update_err)=%%<br>
lookup: %%=rowcount(@lookall)=%%<br>
Email: %%=v(@emailcheck)=%%<br>
CancerCenterSubscribe: %%=v(@CancerCenterSubscribe)=%%<br>
CancerCompassNewsletter: %%=v(@CancerCompassNewsletter)=%%<br>
CancerFighters: %%=v(@CancerFighters)=%%<br>
PersonalizedEduEmails: %%=v(@PersonalizedEduEmails)=%%<br>
hereAndNow: %%=v(@hereAndNow)=%%<br>
riskManagement: %%=v(@riskManagement)=%%<br>
LookCancerCenter: %%=rowcount(@HereNowRows)=%%<br>
CelebrateLife: %%=v(@celebrateLife)=%%
CityStories: %%=v(@CityStories)=%%<br>
PatientAlerts: %%=v(@PatientAlerts)=%%<br>
PatientNewsletter: %%=v(@PatientNewsletter)=%%<br>
PatientOfferings: %%=v(@PatientOfferings)=%%<br>